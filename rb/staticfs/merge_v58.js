;window.countdown=function(){"use strict";function e(t,e,a,s,i,r){this.$el=t,this.date=e,this.format=a,this.dateType=null==s?"localDate":s,this.leadTime=null==i?0:i,this.callback=r,this.init()}return e.prototype={init:function(){this.interval=null,this.currentDate=null,this.standardDate=null,this.totalSecTime=null,this.distributeTime=null,this.formatHtml=null,this.parseDate(this.date),this.getCurrentDate(),this.getTime(this.currentDate,this.standardDate),this.getDistributeTime(this.totalSecTime),this.getFormatHtml(this.format),this.setFormatHtml(this.formatHtml),this._setInterval()},parseDate:function(t){var e=[];if(e.push(/^[0-9]*$/.source),e.push(/([0-9]{1,2}\/){2}[0-9]{4}( [0-9]{1,2}(:[0-9]{2}){2})?/.source),e.push(/[0-9]{4}([\/\-][0-9]{1,2}){2}( [0-9]{1,2}(:[0-9]{2}){2})?/.source),e=new RegExp(e.join("|")),t instanceof Date)return t;if(!String(t).match(e))throw new Error("date:'"+t+"' 格式不正确");String(t).match(/^[0-9]*$/)&&(t=Number(t)),String(t).match(/\-/)&&(t=String(t).replace(/\-/g,"/")),this.standardDate=new Date(t)},getCurrentDate:function(){"localDate"==this.dateType?this.currentDate=new Date:this.currentDate=new Date($.ajax({async:!1}).getResponseHeader("Date"))},getTime:function(t,e){var a=t.getTime(),s=e.getTime(),i=Math.ceil((s-a)/1e3);this.totalSecTime=i<=0?0:i},getDistributeTime:function(t){this.distributeTime={seconds:t%60,minutes:Math.floor(t/60)%60,totalMinutes:Math.floor(t/60),hours:Math.floor(t/60/60)%24,totalHours:Math.floor(t/60/60),days:Math.floor(t/60/60/24)%7,daysToWeek:Math.floor(t/60/60/24)%7,daysToMonth:Math.floor(t/60/60/24%30.4368),totalDays:Math.floor(t/60/60/24),weeks:Math.floor(t/60/60/24/7),months:Math.floor(t/60/60/24/30.4368),years:Math.abs(this.standardDate.getFullYear()-this.currentDate.getFullYear())}},getFormatHtml:function(t){for(var e=t.match(/%(-|!)?[A-Z]{1}(:[^;]+;)?/gi),a=this.format,s=this.distributeTime,i=0;i<e.length;i++)switch(e[i]){case"%Y":a=a.replace("%Y",s.years<10?"0"+s.years:s.years);break;case"%m":a=a.replace("%m",s.months<10?"0"+s.months:s.months);break;case"%n":a=a.replace("%n",s.daysToMonth<10?"0"+s.daysToMonth:s.daysToMonth);break;case"%w":a=a.replace("%w",s.weeks<10?"0"+s.weeks:s.weeks);break;case"%W":a=a.replace("%W",s.daysToWeek<10?"0"+s.daysToWeek:s.daysToWeek);break;case"%d":a=a.replace("%d",s.days<10?"0"+s.days:s.days);break;case"%H":a=a.replace("%H",s.hours<10?"0"+s.hours:s.hours);break;case"%M":a=a.replace("%M",s.minutes<10?"0"+s.minutes:s.minutes);break;case"%S":a=a.replace("%S",s.seconds<10?"0"+s.seconds:s.seconds);break;case"%D":a=a.replace("%D",s.totalDays<10?"0"+s.totalDays:s.totalDays);break;case"%I":a=a.replace("%I",s.totalHours<10?"0"+s.totalHours:s.totalHours);break;case"%N":a=a.replace("%N",s.totalMinutes<10?"0"+s.totalMinutes:s.totalMinutes);break;case"%T":a=a.replace("%T",this.totalSecTime<10?"0"+this.totalSecTime:this.totalSecTime)}this.formatHtml=a},setFormatHtml:function(t){this.$el.html(t)},_setInterval:function(){var t=this;this.interval=setInterval(function(){t.updateCountdown()},1e3)},destroy:function(){this.interval&&clearInterval(this.interval)},updateCountdown:function(){this.totalSecTime==this.leadTime&&null!=this.callback&&(this.callback(),this.getCurrentDate(),this.totalSecTime=this.getTime(this.currentDate,this.standardDate)),this.totalSecTime?(this.totalSecTime-=1,this.getDistributeTime(this.totalSecTime),this.getFormatHtml(this.format),this.setFormatHtml(this.formatHtml)):clearInterval(this.interval)}},{deploy:function(){for(var t=0;t<arguments.length;t++)return new e(arguments[t].$el,arguments[t].date,arguments[t].format,arguments[t].dateType,arguments[t].leadTime,arguments[t].callback)}}}();;;epub360.PlayerPlugins.push({config:{type:"Timer",template:"Timer",model_object:{setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Timer({model:this})}}},render:function(e){var t=this.getdetail();this.iHorizontal=["left","center","right"],this.$el.find(".Element").css("font-size",t.font_size).css("color",t.font_color).css("text-align",this.iHorizontal[t.iPosition]),0==t.iKind||1==t.iKind?this.updateTimerDom(t.formatTime,t.iKind,t.format):2==t.iKind?this.updateTimerDom(t.arrive,t.iKind,t.countdownformat):this.updateTimerDom("",t.iKind,t.timeType),this.model._reset=!0},resetOtherStatus:function(){var e=this.getdetail();2!=e.iKind&&(this.clearTimer(),this.Interval=!1,this.Status=-1,this.Suspend=!1,2==e.format||4==e.format?this.frame=.01:this.frame=1)},startTimer:function(){var i=this,e=this.getdetail(),t=function(){i.updateTimer(),i.Actions_16.length&&interaction_view.events.onTimerCountTo(i),i.currentTime!=e.initial&&i.Actions_18.length&&interaction_view.events.onTimerInterval(i,i.currentTime-e.initial)},s=function(){if(i.Interval){if(i.currentTime<=0)return i.currentTime=0,i.updateTimer(),void i.stopTimer();i.currentTime-=i.frame,e.currentTime=i.currentTime,r(s,i.frame),t()}},n=function(){i.Interval&&(i.currentTime+=i.frame,e.currentTime=i.currentTime,r(n,i.frame),t())},a=function(){r(a),i.updateTimerDom("",e.iKind,e.timeType)},r=function(e,t){i.Timeout&&window.clearTimeout(i.Timeout),i.Timeout=setTimeout(e,1e3*t)};if(3==e.iKind)a();else{if(1==this.Status||3==this.Status)return;if(-1==this.Status)return void(this.Suspend=!0);r(function(){i.Interval=!0,1==e.iKind?s():n()},i.frame),i.Actions_16.length&&interaction_view.events.onTimerCountTo(i),interaction_view.events.onTimerStart(this),this.Status=1}},stopTimerSimple:function(){return 2!=this.Status&&3!=this.Status&&-1!=this.Status&&(this.clearTimer(),this.Status=2,!0)},stopTimer:function(){this.stopTimerSimple()&&(this.Status=3,interaction_view.events.onTimerStop(this))},resetTimer:function(){var i=this,e=this.getdetail();if(2!=e.iKind)if(3==e.iKind)this.startTimer();else{if(this.clearTimer(),this.currentTime=e.initial=Number(Number(e.initial).toFixed(2)),this.Status=0,this.updateTimer(),!this.gotTimerActions){function t(e,t){return e.overlay_id==i.model.id&&e.type==t&&(i.model.page.isLayer?e.layer_id==i.model.page.iOverlaylist.layerid:e.page_id==i.model.page.id)}this.Actions_16=_.filter(interaction_view.events.timerEvents,function(e){return t(e,16)&&0<=e.condition}),this.Actions_18=_.filter(interaction_view.events.timerEvents,function(e){return t(e,18)&&0<e.condition}),this.Actions_17=_.filter(interaction_view.events.timerEvents,function(e){return t(e,17)}),this.Actions_19=_.filter(interaction_view.events.timerEvents,function(e){return t(e,19)}),i.Actions_18.forEach(function(e,t){e.condition=Number(Number(e.condition).toFixed(2))}),this.gotTimerActions=!0}(e.iAutoStart||this.Suspend)&&this.startTimer(),this.Suspend=!1}},updateTimer:function(){var e=this.getdetail();e.formatTime=this.getFormatTime(this.currentTime,e.format),this.updateTimerDom(e.formatTime,e.iKind,e.format)},updateTimerDom:function(e,t,i){var s=this.getdetail();1==t||0==t?this.$el.find(".Element").html(e):2==t?(this.$el.find(".Element").html('<div class="countdown-class"></div>'),this.getCuntdownFormatTime(e,i,s.dateTYPE,s.dateStyle)):(this.$el.find(".Element").html('<div class="current_time_content"></div>'),this.setCurrentTypeTime(i))},getCuntdownFormatTime:function(e,t,i,s){var n,a,r,l,c=this;""==e?r="2017/12/12 00:00:00":r=e;switch(s){case 1:n="format-class1",a="modify-class1";break;case 2:n="format-class2",a="modify-class2";break;case 3:n="format-class3",a="modify-class3";break;case 4:n="format-class4",a="modify-class4";break;default:n="format-classx",a="modify-classx"}switch(Number(t)){case 0:l='<div style="display:inline-block;text-align: center;"><span class="'+n+'">%D</span> <span class="'+a+'">天</span></div>';break;case 1:l='<div style="display:inline-block;text-align: center;"><span class="'+n+'">%I</span> <span class="'+a+'">小时</span></div>';break;case 2:l='<div style="display:inline-block;text-align: center;"><span class="'+n+'">%I</span> <span class="'+a+'">小时</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%M</span> <span class="'+a+'">分</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%S</span> <span class="'+a+'">秒</span></div>';break;case 3:l='<div style="display:inline-block;text-align: center;"><span class="'+n+'">%D</span> <span class="'+a+'">天</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%H</span> <span class="'+a+'">小时</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%M</span> <span class="'+a+'">分</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%S</span> <span class="'+a+'">秒</span></div>';break;case 4:l='<div style="display:inline-block;text-align: center;"><span class="'+n+'">%w</span> <span class="'+a+'">周</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%d</span> <span class="'+a+'">天</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%H</span> <span class="'+a+'">小时</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%M</span> <span class="'+a+'">分</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%S</span> <span class="'+a+'">秒</span></div>';break;case 5:l='<div style="display:inline-block;text-align: center;"><span class="'+n+'">%D</span> <span class="'+a+'">day</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%H</span> <span class="'+a+'">hr</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%M</span> <span class="'+a+'">min</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%S</span> <span class="'+a+'">sec</span></div>';break;case 6:l='<div style="display:inline-block;text-align: center;"><span class="'+n+'">%w</span> <span class="'+a+'">week</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%d</span> <span class="'+a+'">day</span></div> <div style="display:inline-block;text-align: center;"> <span class="'+n+'">%H</span> <span class="'+a+'">hr</span></div> <div style="display:inline-block;text-align: center;"> <span class="'+n+'">%M</span> <span class="'+a+'">min</span></div> <div style="display:inline-block;text-align: center;"><span class="'+n+'">%S</span> <span class="'+a+'">sec</span></div>'}countdown.deploy({$el:$(this.$el.find(".countdown-class")),date:r,format:l,dateType:i,callback:function(){for(var e=_.filter(interaction_view.events.timerEvents,function(e){return interaction_view.events.filterType(c,e,17)}),t=0;t<e.length;t++)e[t].func()}})},clearTimer:function(){this.Interval=!1,this.Timeout&&window.clearTimeout(this.Timeout)},getFormatTime:function(e,t){e=Number(Number(e).toFixed(2));var i=Math.floor(e/24/3600),s=Math.floor(e/3600),n=Math.floor((e-24*i*3600)/3600),a=Math.floor(e/60),r=Math.floor((e-3600*s)/60),l=Math.floor((e-24*i*3600-3600*n)/60),c=Math.floor(e-60*a),o=Math.floor(e-3600*s-60*r),d=Math.floor(e-24*i*3600-3600*n-60*l),m=Math.round(100*(e-Math.floor(e)));switch(Number(t)){case 0:return e<10?"0"+e:e;case 1:return(a<10?"0"+a:a)+":"+(c<10?"0"+c:c);case 2:return(a<10?"0"+a:a)+":"+(c<10?"0"+c:c)+":"+(m<10?"0"+m:m);case 3:return(s<10?"0"+s:s)+":"+(r<10?"0"+r:r)+":"+(o<10?"0"+o:o);case 4:return(s<10?"0"+s:s)+":"+(r<10?"0"+r:r)+":"+(o<10?"0"+o:o)+":"+(m<10?"0"+m:m);case 5:return(i<10?"0"+i:i)+":"+(n<10?"0"+n:n)+":"+(l<10?"0"+l:l)+":"+(d<10?"0"+d:d)}},setCurrentTypeTime:function(e){var t=new Date,i=Number(t.getMonth())+1<10?"0"+(Number(t.getMonth())+1):Number(t.getMonth())+1,s=Number(t.getDate())<10?"0"+Number(t.getDate()):Number(t.getDate()),n=Number(t.getHours())<10?"0"+Number(t.getHours()):Number(t.getHours()),a=Number(t.getMinutes())<10?"0"+Number(t.getMinutes()):Number(t.getMinutes()),r=t.getDay();switch(Number(r)){case 0:r="日";break;case 1:r="一";break;case 2:r="二";break;case 3:r="三";break;case 4:r="四";break;case 5:r="五";break;case 6:r="六"}switch(e){case 0:this.$el.find(".current_time_content").html(n+":"+a);break;case 1:this.$el.find(".current_time_content").html(i+"月"+s+"日");break;case 2:this.$el.find(".current_time_content").html("星期"+r);break;case 3:this.$el.find(".current_time_content").html(i+"月"+s+"日 星期"+r)}}});;